---

- name: 'create a ceph volume'
  become: yes
  command: "cephadm shell -- ceph fs subvolumegroup create swarm docker/{{ volume_name }}"
  loop: "{{ action_restore_volume_names_to_restore | default([]) }}"
  loop_control:
    loop_var: "volume_name"
  changed_when: false
  register: create_ceph_volumes

- name: 'create a docker volume'
  community.docker.docker_volume:
    name: "{{ volume_name }}"
    driver: n0r1skcom/docker-volume-cephfs
    driver_options:
      name: admin
      secret: "{{ lookup('file', homecloud_vault_path~'/ceph.client.admin.secret') | trim }}"
      path: "/volumes/docker/{{ volume_name }}"
      monitors: "{{ homecloud_ceph_monitor_ips }}"
  loop: "{{ action_restore_volume_names_to_restore | default([]) }}"
  loop_control:
    loop_var: "volume_name"
  register: create_ceph_volumes
