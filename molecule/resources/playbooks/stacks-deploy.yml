---

- hosts: all
  vars:
    homecloud_ceph_monitor_ips_as_array: "{{ groups.ceph_mon | default([]) | map('extract', hostvars, ['homecloud_node_ip']) | list }}"
    homecloud_ceph_monitor_ips: "{{ homecloud_ceph_monitor_ips_as_array | join(',') }}"
    homecloud_ceph_is_enabled: "{{ homecloud_ceph_monitor_ips | length > 0 }}"
  pre_tasks:
    - include_role: name="resources_prepare"
  tasks:
    - name: "install swarm stacks"
      include_role:
        name: "{{ swarm_stack }}"
      loop: "{{ swarm_stacks | default([]) }}"
      loop_control:
        loop_var: "swarm_stack"
  post_tasks:
    - include_role: name="resources_clean"
