---

- hosts: swarm_mgr[0]
  tasks:
    - name: Remove a stack
      #shell: "docker stack rm {{ item[6:] }}"
      community.docker.docker_stack:
        name: "{{ item[6:] }}"
        state: absent
      loop: "{{ swarm_stacks | default([]) | reverse }}"

- hosts: all
  tasks:
    - name: Prune Docker unused resources
      community.docker.docker_prune:
        containers: true
        networks: true
        volumes: true
        builder_cache: true
