---

#dependency:
#  name: galaxy
#  options:
#    requirements-file: molecule/resources/collections.yml

driver:
  name: vagrant
  provider:
    name: libvirt

platforms:
  - name: k1-n1
    box: "${MOLECULE_N1_BOX-generic/debian10}"
    provider_options:
      driver: "${MOLECULE_DRIVER-'kvm'}"
    memory: 4096
    cpu: 2
    provider_raw_config_args:
      - "storage :file, :size => '2G'"

provisioner:
  name: ansible
  ansible_args:
    - -e=service_docker_username=$DOCKER_USERNAME
    - -e=service_docker_password=$DOCKER_PASSWORD
  # - -e=cluster_node_skip_reboot=true
  env:
    ANSIBLE_ROLES_PATH: "$ephemeral_directory/roles/:$project_directory/../:~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:$MOLECULE_PROJECT_DIRECTORY/collection/roles"
  config_options:
    ssh_connection:
      scp_if_ssh: true
      control_path: null
  inventory:
    links:
      hosts: inventory/hosts.yml
      group_vars: inventory/group_vars/
      host_vars: inventory/host_vars/

verifier:
  name: ansible
