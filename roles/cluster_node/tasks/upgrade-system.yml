---

- name: 'hold packages'
  become: yes
  command: "apt-mark hold {{ item }}"
  loop: "{{ cluster_node_hold_packages | default([]) }}"
  changed_when: False
  register: upgrade_system
#- debug: var=upgrade_system

- name: 'upgrade the system'
  become: yes
  when: cluster_node_do_upgrade
  apt:
    update_cache: "yes"
    autoclean: "yes"
    autoremove: "yes"
    upgrade: "yes"
    force_apt_get: "yes"
  register: upgrade_system

- name: 'update the system'
  become: yes
  when: not cluster_node_do_upgrade
  apt:
    update_cache: "yes"
    autoclean: "yes"
    autoremove: "yes"
    upgrade: "no"
    force_apt_get: "yes"
  register: upgrade_system
