---

- name: Initialize manager
  community.docker.docker_swarm:
    advertise_addr: "{{ service_swarm_manager_ip }}"
    state: present
    labels: "{{ service_swarm_node_labels }}"
  register: initialize_swarm
  changed_when: false

- name: Fetch manager token
  delegate_to: localhost
  become: false
  copy:
    content: "{{ initialize_swarm.swarm_facts.JoinTokens.Manager }}"
    dest: "{{ homecloud_vault_path }}/token_manager"

- name: Fetch worker token
  delegate_to: localhost
  become: false
  copy:
    content: "{{ initialize_swarm.swarm_facts.JoinTokens.Worker }}"
    dest: "{{ homecloud_vault_path }}/token_worker"
