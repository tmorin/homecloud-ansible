---

- name: 'initialize manager'
  community.general.docker_swarm:
    advertise_addr: "{{ service_swarm_manager_ip }}"
    state: present
    labels: "{{ service_swarm_node_labels }}"
  register: initialize_swarm

- name: 'fetch manager token'
  delegate_to: localhost
  become: false
  copy:
    content: "{{ initialize_swarm.swarm_facts.JoinTokens.Manager }}"
    dest: "{{ playbook_dir }}/vault/token_manager"

- name: 'fetch worker token'
  delegate_to: localhost
  become: false
  copy:
    content: "{{ initialize_swarm.swarm_facts.JoinTokens.Worker }}"
    dest: "{{ playbook_dir }}/vault/token_worker"
