---

- name: 'initialize manager'
  docker_swarm:
    advertise_addr: "{{ swarm_manager_ip }}"
    state: present
    labels: "{{ swarm_node_labels }}"
  register: initialize_swarm

- name: 'fetch manager token'
  delegate_to: localhost
  become: false
  copy:
    content: "{{ initialize_swarm.swarm_facts.JoinTokens.Manager }}"
    dest: vault/token_manager

- name: 'fetch worker token'
  delegate_to: localhost
  become: false
  copy:
    content: "{{ initialize_swarm.swarm_facts.JoinTokens.Worker }}"
    dest: vault/token_worker
