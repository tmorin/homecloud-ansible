---

- name: 'get /etc/ceph/ceph.conf stat'
  stat:
    path: /etc/ceph/ceph.conf
  register: ceph_conf_file

- name: 'initialize the ceph cluster'
  when: not ceph_conf_file.stat.exists
  block:
    - name: 'create /etc/ceph'
      become: yes
      file:
        path: /etc/ceph
        state: directory
      register: initialize_cluster
    - name: 'bootstrap ceph'
      become: yes
      shell: |
        cephadm bootstrap \
          --ssh-user {{ ansible_user }} \
          --mon-ip {{ service_ceph_monitor_ip }} \
          --skip-dashboard \
          --skip-monitoring-stack \
          --skip-firewalld
      register: initialize_cluster
    - name: 'set labels'
      become: yes
      shell: |
        cephadm shell -- ceph orch host label add {{ inventory_hostname }} main
      register: initialize_cluster
