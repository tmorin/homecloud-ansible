---

- name: 'install dependencies'
  become: yes
  package:
    pkg: python3-lxml
    state: present
    force_apt_get: 'yes'
  register: install_syncthing

- name: 'start syncthing@nas.service'
  become: true
  service:
    name: syncthing@nas.service
    enabled: yes
    state: started
  register: install_syncthing

- name: 'stop syncthing@nas.service'
  become: true
  service:
    name: syncthing@nas.service
    state: stopped
  register: install_syncthing

- name: 'remove the Sync folder'
  become: yes
  community.general.xml:
    path: /mnt/nas/.config/syncthing/config.xml
    xpath: /configuration/folder[@id='default']
    state: absent

- name: 'set address'
  become: yes
  community.general.xml:
    path: /mnt/nas/.config/syncthing/config.xml
    xpath: /configuration/gui/address
    value: "{{ nas_syncthing_gui_address }}"

- name: 'set user'
  become: yes
  community.general.xml:
    path: /mnt/nas/.config/syncthing/config.xml
    xpath: /configuration/gui/user
    value: "{{ nas_syncthing_gui_username }}"

- name: 'set password'
  become: yes
  community.general.xml:
    path: /mnt/nas/.config/syncthing/config.xml
    xpath: /configuration/gui/password
    value: "{{ nas_syncthing_gui_password }}"

- name: 'stop syncthing@nas.service'
  become: true
  service:
    name: syncthing@nas.service
    state: started
  register: install_syncthing

- name: 'uninstall dependencies'
  become: yes
  package:
    pkg: python-lxml
    state: absent
    force_apt_get: 'yes'
  register: install_syncthing
